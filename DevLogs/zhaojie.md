<center>
<h1>腾讯前端仿网易云开发日志</h1>
</center>

---------

<center>
赵桀
</center>

#### 11.22 ####

##### 结果 #####
* 完成了react+ts的项目初始化，删除不必要文件。
* 添加了axios，react-router-dom，axios，mobx，less等三方库以及相关配置。
* 初步移植之前写的网易云音乐首页。

##### 问题及解决 #####
* yarn eject报错，进行一次git add以及commit后能成功暴露配置。
* less-loader默认安装版本过高，会报错，降级安装。
* react-router进行了一次大版本更新，switch废用，改为routes，route里边的component改为element，NavLink的activeClassName不再生效，改用isActive来设置类名。

#### 11.23 ####

##### 结果 #####
* 简陋地完成了js向ts的转换，很多类型用的是any。
* 完成了404页面、

##### 问题及解决 #####
* 将项目整体由js改为ts时，之前设置的路径别名不起作用，于是在tsconfig的compilerOptions字段里设置paths。
* ts引入图片会报错，新建一个images.d.ts文件，声明图片类型，并在tsconfig的includes字段里引用该文件。
* axios的返回值类型不知道怎么定义，全弄成any了。
* antd的Carousel组件的auto属性报错，因为升级，这个属性名被改为autoplay了。
* useRef绑定ref时，那个类型也不知道是啥，全改成any了。
* Route中的exact属性报错，不是很清楚怎么回事，删掉好像也没出现问题，好像默认就是精确匹配了。
* JSX中的img标签的url属性不起作用，用模块的方式引入图片。

#### 11.24 ####

##### 结果 #####
* 做完了歌曲详情页。
* 优化了之前重构的ts代码。

##### 问题及解决 #####
* JSX里style设置不了伪元素，所以还是用span元素来代替。
* 伪元素好像没有伪类，不用就好。
* 字符串里的换行符在浏览器里不能被正常显示，用正则匹配筛选变成数组。

#### 11.25 ####

##### 结果 #####
* 评论功能做完。
* 完成了Pagination的重新封装。
* 拼接好了歌曲详情以及评论。

##### 问题及解决 #####
* Antd的Pagination的样式难以更改，硬改了。
* 你永远不知道Antd都有哪些sb样式。
* Pagination组件封装后defaultCurrent不起作用,查了一下是传参引起的，但是没找到解决办法。
* 路由跳转时会记录当前的滚动位置，都在componentDidMount里滚到最上边，但是这样就没法保存之前的滚动了，不过好像浏览器帮你保存了。
* 意外修复好了之前defaultCurrent不起作用导致的不能正确渲染的问题。

#### 11.27 ####

##### 结果 #####
* 开了一次组会，明确了一下各自的任务，我负责首页，歌曲详情，歌单详情，专辑详情，登录功能，播放功能。
* 完成了专辑详情页面以及与评论的拼接。
* 优化了util文件结构，优化了部分css命名。

#### 11.28 ####

##### 结果 #####
* 做完了歌单详情页以及与评论的拼接。
* 优化了部分之前的代码。

##### 问题及解决 #####
* 这个鬼接口根本没说清楚哪些字段是可能没有的，烦得要死。
* 字符串里的换行符在html中不显示，解决方法是在css里设置white-space: pre-line;

#### 11.29 ####

##### 结果 #####
* 完成部分二维码登录页面。
* 优化部分之前代码。

##### 问题及解决 #####
* Link标签不能新建标签页，改用a标签，但设置target为_blank时，会有警告，设置ref为noreferrer解决。
* 用二维码登录，判断登录状态时用递归的方式实现了长轮询，但是网络请求返回的结果过了很久才会是正确的结果，一开始怀疑是缓存的问题，把请求方法改为post后仍不对，暂时没想到解决的办法。

#### 11.30 ####

##### 结果 #####
* 登录页面功能实现。
* 修复了轮播图的一个bug。

##### 问题及解决 #####
* 进一步测试二维码登录的功能，发现登录后，即使是用postman来测试，也需要2分钟左右时间才能正确收到登陆成功的消息码，但是用这个api自己给的测试链接时，是没有这么大的延迟的，没搞懂。
* 去api的测试链接观察网络发送情况，发现每次在发起请求的时候是携带了一个时间戳的，于是在代码里也加上时间戳，就能实时获得响应，可是这个接口文档里完全没提这个事，写得真烂。
* 同样，为了保证每次打开登录面板二维码的不同，也给获得key时加了一个时间戳。
* 扫码次数过多，两个账号都给我冻结了。
* 忽然发现轮播图好像有专辑，单曲，歌单，反正就是啥都有，而且没有找到比较明显的字段来区分它们。targetType好像可以，但是不是很好做。

#### 12.3 ####

##### 结果 #####
* 完成了登录功能。
* 完善了首页关于登录的部分。

##### 问题及解决 #####
* antd的样式会污染全局，暂时倒是问题不大，今后还是考虑用一个模块化css的工具。

#### 12.13 ####

##### 结果 #####
* 初步完成底部音乐播放栏

##### 问题及解决 #####
* 引入第三方音乐播放器aplayer，但是并不支持ts，于是引入时报错，需要在module.d.ts里声明一下这个模块。
* 调用获取音乐url的mp3时，播放一段时间就404了，按照文档给出的笨办法解决了。
* 这个播放器很多样式是行内样式，直接用!important给他做了。
  
#### 12.14 ####

##### 结果 #####
* 完善播放器的一个小细节。
* 优化了部分代码。
* 完成了音乐播放的功能，因为一些逻辑我不是很了解，所以做得比较简陋。
* 完成了单曲，循环，随机的功能。
* 对部分代码进行了重构。
* 基本将相关页面对播放器的支持添加完毕。

##### 问题及解决 #####
* 被这个mobx卡住了，变成mobx6以后，很多之前的东西都不能用了，想找一个文档是极其困难。
* 发现轮播图又出问题了，原来是接口又新增了一些类型，真是烦死了。
* mobx页面不会重新渲染，不知是不是用法不对，市面上真是鱼龙混杂，什么样的都有。
* 搞了半天，原来不是mobx的问题，是那个播放器作为参数传进去的值，不会变，它新加歌曲的方式不是我想的那样。
* 现在又遇到一个问题，react不能捕获这个播放器的数据变化，即使我用setState也是如此。
* 前边用!important出现了一点问题，这样背景图片也不能重写了，这些第三方库真是讨厌，目前是用了点小技巧给他解决了。
* 遇到了一个The error you provided does not contain a stack trace.去搜说是浏览器机制问题，没有解决办法，唉。
* 那个播放器初始化传的audio参数如果是空的会有问题，之前好像不会这样，暂时没想到是哪儿的问题。
* 找到问题了，是useEffect的锅，因为初始时list是空的，然后添加到列表是如果是空的就会有问题，加个判断。
* \[MobX] Since strict-mode is enabled, changing (observed) observable values without using an action is not allowed. Tried to modify: Store@1.playlist[..].name 有40个这个警告，暂时没找出是什么问题导致的。
* 上个问题解决了，好像是把autorun改成了reaction，或者是什么，反正是在修其他bug时顺带就把它解决了。
* 了解到useEffect的依赖是浅比较，但是我的依赖是对象里的属性，也有可能是因为是第三方引起的变化没有被react捕获到，反正现在是没找到合适的解决方法。
* 找到了为什么之前mobx的数组push进去后没有反应的原因，他也是浅比较。
* 部分专辑用接口给的歌曲url404了，倒不是个大问题，没有解决。

#### 12.15 ####

##### 结果 #####
* 基本修复之前的bug。
* 更改了添加歌曲的逻辑。
* 重构了一下代码。
* 完成了播放列表和歌词。

##### 问题及解决 #####
* 之前那个react监听对象浅比较的问题，在腾讯导师的帮助下，一针见血地指出三方库应该是通过事件监听来处理的，于是解决了。
* arr.map里边用了异步，但是并不正确，改为for of循环。
* 这个歌词只能通过发送一次网络请求获得，如果是添加一个歌单的话，就要发几十上百次请求，出现明显卡顿，暂时未想到解决方式。
* 尝试在播放器的事件监听里寻找解决办法，未果。